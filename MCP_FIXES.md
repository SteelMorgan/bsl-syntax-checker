# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

## üö® –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### **–ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞**

**‚ùå –ë—ã–ª–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):**
```kotlin
// StdioTransport.kt - —Å—Ç—Ä–æ–∫–∞ 62
val tool = request["tool"] as? String ?: run {
    writeError("Missing 'tool' field in request")
    return
}
```

**‚úÖ –°—Ç–∞–ª–æ (–ü–†–ê–í–ò–õ–¨–ù–û):**
```kotlin
val method = request["method"] as? String ?: run {
    writeJsonRpcError(request["id"], -32600, "Invalid Request", "Missing 'method' field")
    return
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** MCP –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON-RPC 2.0 —Å –ø–æ–ª–µ–º `"method"`, –∞ –Ω–µ `"tool"`.

### **–ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ MCP –º–µ—Ç–æ–¥—ã**

**‚ùå –ë—ã–ª–æ:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
**‚úÖ –°—Ç–∞–ª–æ:** –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ MCP –º–µ—Ç–æ–¥—ã:
- `initialize` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- `tools/list` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤  
- `tools/call` - –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

### **–ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤**

**‚ùå –ë—ã–ª–æ:**
```kotlin
// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –Ω–µ—Ç JSON-RPC –æ–±–µ—Ä—Ç–∫–∏
writeResponse(mapOf("status" to "success", "data" to result.data))
```

**‚úÖ –°—Ç–∞–ª–æ:**
```kotlin
// –ü—Ä–∞–≤–∏–ª—å–Ω–æ - —Å JSON-RPC –æ–±–µ—Ä—Ç–∫–æ–π
writeJsonRpcResponse(id, result)
```

## üìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **StdioTransport.kt**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `method` –≤–º–µ—Å—Ç–æ `tool`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `handleInitialize`, `handleToolsList`, `handleToolsCall`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `writeJsonRpcResponse` –∏ `writeJsonRpcError`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ MCP

### 2. **HttpTransport.kt**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω endpoint —Å `/tools/{tool}` –Ω–∞ `/mcp` (POST)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON-RPC –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ –∂–µ –º–µ—Ç–æ–¥—ã, —á—Ç–æ –∏ –≤ StdioTransport
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ MCP

### 3. **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ MCP**
- ‚úÖ –í—Å–µ –æ—Ç–≤–µ—Ç—ã —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `content` —Å –º–∞—Å—Å–∏–≤–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ `{type: "text", text: "..."}`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫—Ä–∞—Å–∏–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —ç–º–æ–¥–∑–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON-RPC 2.0

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test-mcp-fix.ps1` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

```powershell
.\test-mcp-fix.ps1
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. ‚úÖ –ó–∞–ø—É—â–µ–Ω –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
2. ‚úÖ MCP Initialize –∑–∞–ø—Ä–æ—Å
3. ‚úÖ MCP Tools List –∑–∞–ø—Ä–æ—Å  
4. ‚úÖ MCP Tools Call –∑–∞–ø—Ä–æ—Å (analyze)
5. ‚úÖ HTTP API endpoint

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚ùå Cursor IDE –Ω–µ –≤–∏–¥–µ–ª —Å–ø–∏—Å–æ–∫ tools
- ‚ùå –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ analyze
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ Cursor IDE –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ MCP —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ –°–ø–∏—Å–æ–∫ tools –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã analyze —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON-RPC 2.0 —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

## üîÑ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑:**
   ```powershell
   docker build -t mcp-bsl-server:latest .
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
   ```powershell
   docker stop mcp-bsl-server-checker
   docker run --rm -d --name mcp-bsl-server-checker -e MCP_TRANSPORT=http -p 9090:9090 -p 8080:8080 -v "D:\My Projects\Projects 1C:/workspaces:ro" mcp-bsl-server:latest
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
   ```powershell
   .\test-mcp-fix.ps1
   ```

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Cursor IDE** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ MCP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### **MCP –ø—Ä–æ—Ç–æ–∫–æ–ª (JSON-RPC 2.0):**

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/list",
  "params": {}
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "tools": [...]
  }
}
```

### **–û—à–∏–±–∫–∞:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "error": {
    "code": -32601,
    "message": "Method Not Found"
  }
}
```

---

**üéâ –¢–µ–ø–µ—Ä—å MCP —Å–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –∏ –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å Cursor IDE!**
