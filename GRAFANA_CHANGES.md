# Grafana: –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ê–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Grafana —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!**

- –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000 ‚Äî –∏ –≤—ã —Å—Ä–∞–∑—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- –ù–∏–∫–∞–∫–∏—Ö –ª–æ–≥–∏–Ω–æ–≤/–ø–∞—Ä–æ–ª–µ–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- –†–æ–ª—å –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: **Editor** (–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã)

**–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ:** –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `grafana/grafana.ini`, –∏–∑–º–µ–Ω–∏—Ç–µ `enabled = true` –Ω–∞ `enabled = false` –≤ —Å–µ–∫—Ü–∏–∏ `[auth.anonymous]`, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Grafana.

### 2. –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ "MCP BSL Server - –õ–æ–≥–∏"

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

| –ü–∞–Ω–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| **–õ–æ–≥–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º** | –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫: INFO, WARN, ERROR |
| **–í—Å–µ –ª–æ–≥–∏** | –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å –ø–æ–∏—Å–∫–æ–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π |
| **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** | –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º |
| **–û—à–∏–±–∫–∏/–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** | –¢–æ–ª—å–∫–æ ERROR –∏ WARN |

**–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞:** http://localhost:3000/d/mcp-bsl-logs

### 3. –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

1. **`docker-compose.yml`**
   - –£–±—Ä–∞–Ω—ã environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `grafana.ini`)
   - –î–æ–±–∞–≤–ª–µ–Ω volume –¥–ª—è `grafana.ini`
   - Prometheus –ø–æ—Ä—Ç –∏–∑–º–µ–Ω—ë–Ω: `9091:9090`

2. **`grafana/grafana.ini`** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - –í–∫–ª—é—á–µ–Ω –∞–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø
   - –†–æ–ª—å: Editor
   - –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: Main Org.
   - –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –¥–∞—à–±–æ—Ä–¥: `mcp-bsl-logs.json`

3. **`grafana/provisioning/datasources/datasources.yml`**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã UID –¥–ª—è Loki –∏ Prometheus
   - –î–æ–±–∞–≤–ª–µ–Ω `maxLines: 1000` –¥–ª—è Loki

4. **`grafana/provisioning/dashboards/mcp-bsl-logs.json`** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - 4 –ø–∞–Ω–µ–ª–∏ —Å –ª–æ–≥–∞–º–∏
   - Auto-refresh –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
   - –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –º–∏–Ω—É—Ç

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- **`grafana/README.md`** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- **`docs/GRAFANA_QUICKSTART.md`** ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **`README.md`** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å —Å—Å—ã–ª–∫–∞–º–∏

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ó–∞–ø—É—Å–∫ —Å Grafana:

```powershell
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫
docker-compose up -d

# –û—Ç–∫—Ä–æ–π—Ç–µ Grafana (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
Start-Process "http://localhost:3000"

# –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –Ω–∞–ø—Ä—è–º—É—é
Start-Process "http://localhost:3000/d/mcp-bsl-logs"
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

| –°–µ—Ä–≤–∏—Å | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|----------|
| MCP Server | http://localhost:9090 | Web UI + API |
| Grafana | http://localhost:3000 | –õ–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) |
| –î–∞—à–±–æ—Ä–¥ –ª–æ–≥–æ–≤ | http://localhost:3000/d/mcp-bsl-logs | –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ |
| Prometheus | http://localhost:9091 | –ú–µ—Ç—Ä–∏–∫–∏ (raw data) |
| Loki | http://localhost:3100 | API –¥–ª—è –ª–æ–≥–æ–≤ |

## üìä –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ LogQL

### –í Grafana Explore –∏–ª–∏ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ:

```logql
# –í—Å–µ –ª–æ–≥–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞
{job="mcp-bsl-server"}

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
{job="mcp-bsl-server"} |= "ERROR"

# –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
{job="mcp-bsl-server"} |~ "ERROR|WARN"

# –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É "session"
{job="mcp-bsl-server"} |= "session"

# –õ–æ–≥–∏ —Å timestamp –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
{job="mcp-bsl-server"} [5m]

# –ü–æ–¥—Å—á—ë—Ç –æ—à–∏–±–æ–∫
count_over_time({job="mcp-bsl-server"} |= "ERROR" [$__interval])

# –õ–æ–≥–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º
{job="mcp-bsl-server"} | json | level="ERROR"
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

### –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `grafana/grafana.ini`
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª `[auth.anonymous]`
3. –ò–∑–º–µ–Ω–∏—Ç–µ:
   ```ini
   [auth.anonymous]
   enabled = false  # –ë—ã–ª–æ: true
   ```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```powershell
   docker-compose restart grafana
   ```
5. –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—Ö–æ–¥–µ –Ω—É–∂–µ–Ω –ª–æ–≥–∏–Ω: `admin`, –ø–∞—Ä–æ–ª—å: `admin`

### –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (–≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –±—ã–ª–æ):

1. –í `grafana/grafana.ini` –∏–∑–º–µ–Ω–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ:
   ```ini
   [auth.anonymous]
   enabled = true  # –ë—ã–ª–æ: false
   ```
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Grafana

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **`grafana/README.md`** ‚Äî –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ Grafana
- **`docs/GRAFANA_QUICKSTART.md`** ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ –ø—Ä–∏–º–µ—Ä—ã
- **`docs/GRAFANA_SETUP.md`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∞—à–±–æ—Ä–¥–æ–≤

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ê–Ω–æ–Ω–∏–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑ –ª–æ–≥–∏–Ω–∞
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥** ‚Äî –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
3. **–õ–µ–≥–∫–æ –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é** ‚Äî –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥–µ
4. **–†–æ–ª—å Editor** ‚Äî –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã
5. **Auto-refresh** ‚Äî –ª–æ–≥–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

## üêõ Troubleshooting

### –ù–µ—Ç –ª–æ–≥–æ–≤ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ?

```powershell
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MCP Server
docker ps | Select-String "mcp-bsl-server-checker"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Loki
Invoke-RestMethod "http://localhost:3100/loki/api/v1/label/job/values"
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: ["mcp-bsl-server"]

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ Grafana
# Settings ‚Üí Data Sources ‚Üí Loki ‚Üí Test
```

### –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é?

```powershell
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥
docker exec mcp-bsl-grafana cat /etc/grafana/grafana.ini | Select-String "auth.anonymous"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: enabled = true
# –ï—Å–ª–∏ –Ω–µ—Ç, –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
docker-compose stop grafana
docker-compose rm -f grafana
docker-compose up -d grafana
```

## üìù –ò—Ç–æ–≥–æ

‚úÖ Grafana —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é  
‚úÖ –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å –ª–æ–≥–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è  
‚úÖ –†–æ–ª—å Editor –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ –õ–µ–≥–∫–æ –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –æ–±—Ä–∞—Ç–Ω–æ (–æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä)  
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ README  

**–û—Ç–∫—Ä—ã—Ç—å Grafana:** http://localhost:3000  
**–û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥ –ª–æ–≥–æ–≤:** http://localhost:3000/d/mcp-bsl-logs

